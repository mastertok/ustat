# Архитектура системы Ustat

## 1. Модели данных

### 1.1 Пользователи (accounts)

#### User
- Основные поля:
  - email (Email) - уникальный идентификатор пользователя
  - first_name (Имя)
  - last_name (Фамилия)
  - phone (Телефон)
  - is_active (Активен)
  - is_staff (Сотрудник)
  - date_joined (Дата регистрации)

#### TeacherProfile
- Связь: One-to-One с User
- Поля:
  - bio (Биография)
  - expertise (Специализация)
  - experience_years (Опыт работы)
  - education (Образование)
  - achievements (Достижения)
  - rating (Рейтинг)
  - courses_count (Количество курсов)
  - students_count (Количество студентов)
  - reviews_count (Количество отзывов)

#### StudentProfile
- Связь: One-to-One с User
- Поля:
  - interests (Интересы)
  - level (Уровень)
  - completed_courses (Завершенные курсы)
  - enrolled_courses (Текущие курсы)
  - certificates (Сертификаты)

### 1.2 Курсы (courses)

#### Course
- Основные поля:
  - title (Название)
  - slug (URL-идентификатор)
  - description (Описание)
  - teacher (Преподаватель)
  - category (Категория)
  - type (Тип курса)
  - level (Уровень сложности)
  - language (Язык)
  - price (Цена)
  - duration (Продолжительность)
  - status (Статус)
  - students_count (Количество студентов)
  - lessons_count (Количество уроков)
  - average_rating (Средний рейтинг)
  - reviews_count (Количество отзывов)
  - created_at (Дата создания)
  - updated_at (Дата обновления)
  - published_at (Дата публикации)
  - archived_at (Дата архивации)

#### Lesson
- Связь: Many-to-One с Course
- Поля:
  - title (Название)
  - content (Содержание)
  - duration (Продолжительность)
  - order (Порядок)
  - is_free (Бесплатный урок)
  - video_url (Ссылка на видео)
  - attachments (Приложенные файлы)

### 1.3 Отзывы (reviews)

#### Review
- Связи:
  - course (Course)
  - user (User)
- Поля:
  - rating (Оценка)
  - text (Текст отзыва)
  - created_at (Дата создания)
  - is_approved (Одобрен)

#### Reply
- Связи:
  - review (Review)
  - user (User)
- Поля:
  - text (Текст ответа)
  - created_at (Дата создания)

### 1.4 Аналитика (analytics)

#### CourseView
- Связи:
  - course (Course)
  - user (User)
- Поля:
  - viewed_at (Дата просмотра)
  - source (Источник)
  - device (Устройство)

#### LessonProgress
- Связи:
  - lesson (Lesson)
  - user (User)
- Поля:
  - status (Статус)
  - progress (Прогресс)
  - started_at (Начало)
  - completed_at (Завершение)

## 2. Бизнес-процессы

### 2.1 Регистрация и авторизация
1. Регистрация пользователя
   - Создание базового профиля
   - Выбор роли (студент/преподаватель)
   - Подтверждение email
   - Заполнение дополнительной информации

2. Авторизация
   - JWT-токены для API
   - Сессии для веб-интерфейса
   - Восстановление пароля

### 2.2 Управление курсами
1. Создание курса
   - Базовая информация
   - Добавление уроков
   - Загрузка материалов
   - Настройка цены

2. Модерация курса
   - Проверка контента
   - Утверждение публикации
   - Обратная связь автору

3. Публикация курса
   - Автоматические проверки
   - Генерация превью
   - Индексация для поиска

### 2.3 Обучение
1. Запись на курс
   - Проверка доступности
   - Обработка оплаты
   - Предоставление доступа

2. Прохождение курса
   - Отслеживание прогресса
   - Выполнение заданий
   - Получение обратной связи

3. Завершение курса
   - Финальное тестирование
   - Выдача сертификата
   - Сбор отзыва

### 2.4 Отзывы и рейтинги
1. Создание отзыва
   - Проверка завершения курса
   - Модерация контента
   - Расчет рейтинга

2. Обработка ответов
   - Уведомления
   - Модерация
   - Обновление статистики

### 2.5 Аналитика
1. Сбор данных
   - Активность пользователей
   - Прогресс обучения
   - Финансовые показатели

2. Формирование отчетов
   - Статистика курсов
   - Анализ аудитории
   - Финансовая отчетность

## 3. API Endpoints

### 3.1 Аутентификация
- POST /api/auth/register/ - Регистрация
- POST /api/auth/login/ - Вход
- POST /api/auth/refresh/ - Обновление токена
- POST /api/auth/password/reset/ - Сброс пароля

### 3.2 Пользователи
- GET /api/users/profile/ - Профиль пользователя
- PUT /api/users/profile/ - Обновление профиля
- GET /api/users/teachers/ - Список преподавателей
- GET /api/users/students/ - Список студентов

### 3.3 Курсы
- GET /api/courses/ - Список курсов
- POST /api/courses/ - Создание курса
- GET /api/courses/{id}/ - Детали курса
- PUT /api/courses/{id}/ - Обновление курса
- DELETE /api/courses/{id}/ - Удаление курса

### 3.4 Уроки
- GET /api/courses/{course_id}/lessons/ - Список уроков
- POST /api/courses/{course_id}/lessons/ - Создание урока
- GET /api/lessons/{id}/ - Детали урока
- PUT /api/lessons/{id}/ - Обновление урока
- DELETE /api/lessons/{id}/ - Удаление урока

### 3.5 Отзывы
- GET /api/courses/{course_id}/reviews/ - Отзывы курса
- POST /api/courses/{course_id}/reviews/ - Создание отзыва
- PUT /api/reviews/{id}/ - Обновление отзыва
- DELETE /api/reviews/{id}/ - Удаление отзыва

### 3.6 Аналитика
- GET /api/analytics/courses/ - Статистика курсов
- GET /api/analytics/users/ - Статистика пользователей
- GET /api/analytics/revenue/ - Финансовая статистика

## 4. Права доступа

### 4.1 Роли пользователей
- Анонимный пользователь
- Зарегистрированный пользователь
- Студент
- Преподаватель
- Модератор
- Администратор

### 4.2 Разрешения
- Курсы:
  - Просмотр (все)
  - Создание (преподаватель)
  - Редактирование (автор, администратор)
  - Удаление (автор, администратор)

- Уроки:
  - Просмотр (записанные студенты)
  - Создание (преподаватель)
  - Редактирование (автор, администратор)
  - Удаление (автор, администратор)

- Отзывы:
  - Просмотр (все)
  - Создание (студенты курса)
  - Редактирование (автор)
  - Удаление (автор, администратор)

- Аналитика:
  - Базовая (преподаватель - свои курсы)
  - Полная (администратор)

## 5. Интеграции

### 5.1 Платежные системы
- Stripe
- PayPal
- Локальные платежные шлюзы

### 5.2 Хранение файлов
- Amazon S3
- Локальное хранилище

### 5.3 Видео-хостинг
- YouTube
- Vimeo
- Собственное хранилище

### 5.4 Уведомления
- Email
- Push-уведомления
- SMS

## 6. Мониторинг и логирование

### 6.1 Системные логи
- Ошибки
- Предупреждения
- Информационные события

### 6.2 Бизнес-события
- Регистрации
- Транзакции
- Действия пользователей

### 6.3 Метрики
- Производительность
- Доступность
- Использование ресурсов
